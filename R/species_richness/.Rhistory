colnames(map)<-c("YEAR", "ID", "group_id", "sp_id")
#class(map$sp_id)
map<-as_tibble(map)
year=1198
for (year in c(1199:0)){
y_str<-as.character(year)
item<-map %>% filter(YEAR==year)
if (nrow(item)==0){
next
}
if (y_str %in% names(result)){
result[[y_str]]<-bind_rows(result[[y_str]], item)
}else{
result[[y_str]]<-item
}
}
}
item
class(item$sp_id)
class(result[[y_str]]$sp_id)
i
result<-list()
for (i in c(1:length(simulations))){
sim <- simulations[i]
if (!(grepl(nb, sim)&grepl(da, sim))){
next
}
print(i)
map<-read.table(sprintf("%s/%s/%s.log", target, sim, sim), head=F, sep=",", stringsAsFactors = F)
colnames(map)<-c("YEAR", "ID", "group_id", "sp_id")
#class(map$sp_id)
map<-as_tibble(map)
year=1198
for (year in c(1199:0)){
y_str<-as.character(year)
item<-map %>% filter(YEAR==year)
if (nrow(item)==0){
next
}
if (y_str %in% names(result)){
result[[y_str]]<-bind_rows(result[[y_str]], item)
}else{
result[[y_str]]<-item
}
}
}
i=25
sim <- simulations[i]
if (!(grepl(nb, sim)&grepl(da, sim))){
next
}
print(i)
map<-read.table(sprintf("%s/%s/%s.log", target, sim, sim), head=F, sep=",", stringsAsFactors = F)
colnames(map)<-c("YEAR", "ID", "group_id", "sp_id")
class(map$sp_id)
map
map$sp_id<-as.numeric(map$sp_id)
class(map$sp_id)
#class(map$sp_id)
map<-as_tibble(map)
class(map$sp_id)
year=1198
i=2
result<-list()
for (i in c(1:length(simulations))){
sim <- simulations[i]
if (!(grepl(nb, sim)&grepl(da, sim))){
next
}
print(i)
map<-read.table(sprintf("%s/%s/%s.log", target, sim, sim), head=F, sep=",", stringsAsFactors = F)
colnames(map)<-c("YEAR", "ID", "group_id", "sp_id")
map$sp_id<-as.numeric(map$sp_id)
#class(map$sp_id)
map<-as_tibble(map)
year=1198
for (year in c(1199:0)){
y_str<-as.character(year)
item<-map %>% filter(YEAR==year)
if (nrow(item)==0){
next
}
if (y_str %in% names(result)){
result[[y_str]]<-bind_rows(result[[y_str]], item)
}else{
result[[y_str]]<-item
}
}
}
result<-list()
for (i in c(1:length(simulations))){
sim <- simulations[i]
if (!(grepl(nb, sim)&grepl(da, sim))){
next
}
print(i)
map<-read.table(sprintf("%s/%s/%s.log", target, sim, sim), head=F, sep=",", stringsAsFactors = F)
colnames(map)<-c("YEAR", "ID", "group_id", "sp_id")
map$sp_id<-as.character(map$sp_id)
#class(map$sp_id)
map<-as_tibble(map)
year=1198
for (year in c(1199:0)){
y_str<-as.character(year)
item<-map %>% filter(YEAR==year)
if (nrow(item)==0){
next
}
if (y_str %in% names(result)){
result[[y_str]]<-bind_rows(result[[y_str]], item)
}else{
result[[y_str]]<-item
}
}
}
result[[y_str]]
year
setwd("~/git/ees_3d/R/species_richness")
saveRDS("%s/../Tables/%s.%s.rda", target, nb, da)
saveRDS(result, sprintf("%s/../Tables/%s.%s.rda", target, nb, da))
simulations
head(simulations)
length(simulations)
df<-readRDS(sprintf("%s/../Tables/%s.%s.rda", target, nb, da))
y<-names(df)[1]
y
df[[y]]
df[[y]] %>% count(ID, sp_id)
y<-names(df)[1199]
df[[y]]
df[[y]]%>%filter(sp_id=="10369-1-2")%>%count(ID)
table(df[[y]]%>%filter(sp_id=="10369-1-2")%>%count(ID)$n)
table((df[[y]]%>%filter(sp_id=="10369-1-2")%>%count(ID))$n)
df[[y]]%>%count(ID)
shape <- readOGR(dsn = "/home/huijieqiao/git/ees_3d_data/ISEA3H8/isea3hGen/outputfiles", layer = "isea3h8p")
richness_df<-df[[y]]%>%count(ID)
richness_df
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% suitable$richness_df)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, suitable, by=c("global_id"="ID"))
shape_t@data
richness_df$ID
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@coords
head(shape_t@coords)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% suitable$richness_df)
shape_t@data
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, suitable, by=c("global_id"="ID"))
shape_t@data
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t)
shape_t@coords
head(shape_t@coords)
ggplot(data=shape_t,aes(coords.x1, coords.x2)+geom_point()
sadf
ggplot(data=shape_t,aes(coords.x1, coords.x2))+geom_point()
map<-fortify(shape_t)
map<-fortify(shape_t, col=shape_t@data$n, cex=0.2)
plot(shape_t, col=shape_t@data$n, cex=0.2)
shape_t@data$n
colfunc <- colorRampPalette(c("blue", "red"))
plot(shape_t, col=colfunc(100)[shape_t@data$n], cex=0.2)
map("world", fill=TRUE, col="white", bg="lightblue", ylim=c(-60, 90), mar=c(0,0,0,0))
plot(shape_t, col=colfunc(100)[shape_t@data$n], cex=0.2, add=T)
devtools::install_github('thomasp85/gganimate')
?dir.create
dir.create(sprintf("%s/../Figures/Richness/%s_%s", target, nb, da), showWarnings=F)
y
?png
cmd<-"ffmpeg -framerate 10 -pattern_type glob -i '%s/*.png' -c:v libx264 -pix_fmt yuv420p %s/%s_%s.mp4"
y_i=1
y<-names(df)[y_i]
y
?plot
plot(shape_t, col=colfunc(100)[shape_t@data$n], cex=0.2, add=T, main=y)
map("world", fill=TRUE, col="white", bg="lightblue", ylim=c(-60, 90), mar=c(0,0,0,0), main="Asdf")
map("world", fill=TRUE, col="white", bg="lightblue", ylim=c(-60, 90), mar=c(0,0,0,0), main="Asdf")
map("world", fill=TRUE, col="white", bg="lightblue", ylim=c(-60, 90), mar=c(0,0,0,0))
plot("world", fill=TRUE, col="white", bg="lightblue", ylim=c(-60, 90), mar=c(0,0,0,0))
?map
map("world", fill=TRUE, col="white", bg="lightblue", ylim=c(-60, 90), mar=c(0,0,0,0))
map("world", fill=TRUE, col="white", bg="lightblue", ylim=c(-60, 90), mar=c(0,0,0,0))
map("world", fill=TRUE, col="white", bg="lightblue", ylim=c(-60, 90), mar=c(0,0,0,0), main=y)
worldmap<-readOGR(dsn = "/home/huijieqiao/git/ees_3d_data/Shape/continents", layer = "continent")
plot(worldmap)
plot(worldmap, col="grey")
plot(worldmap, border="grey")
plot(worldmap, border="grey", main=y)
plot(worldmap, border="grey", main=(y*-1))
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
?png
png(filename = sprintf("%s/%s.png", target, str_pad(y_i, 4, pad="0")),
width = 1600, height = 900, units = "px")
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t, col=colfunc(100)[shape_t@data$n], cex=0.2, add=T, main=y)
dev.off()
sprintf("%s/%s.png", target, str_pad(y_i, 4, pad="0")
)
target
source<-"/home/huijieqiao/git/ees_3d_data/TEST/Results"
target<-sprintf("%s/../Figures/Richness/%s_%s", target, nb, da)
dir.create(target, showWarnings=F)
target
png(filename = sprintf("%s/%s.png", target, str_pad(y_i, 4, pad="0")),
width = 1600, height = 900, units = "px")
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t, col=colfunc(100)[shape_t@data$n], cex=0.2, add=T, main=y)
dev.off()
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
png(filename = sprintf("%s/%s.png", target, str_pad(y_i, 4, pad="0")),
width = 1600, height = 900, units = "px")
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t, col=colfunc(100)[shape_t@data$n], cex=1, add=T, main=y)
dev.off()
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
plot(shape_t, col=colfunc(100)[shape_t@data$n], cex=1, pch=22, add=T)
png(filename = sprintf("%s/%s.png", target, str_pad(y_i, 4, pad="0")),
width = 1600, height = 900, units = "px")
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t, col=colfunc(100)[shape_t@data$n], cex=1, pch=22, add=T)
dev.off()
plot(shape_t, col=colfunc(100)[shape_t@data$n], cex=1, pch=15, add=T)
png(filename = sprintf("%s/%s.png", target, str_pad(y_i, 4, pad="0")),
width = 1600, height = 900, units = "px")
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t, col=colfunc(100)[shape_t@data$n], cex=1, pch=15, add=T)
dev.off()
png(filename = sprintf("%s/%s.png", target, str_pad(y_i, 4, pad="0")),
width = 1600, height = 900, units = "px")
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t, col=colfunc(100)[shape_t@data$n], cex=0.5, pch=15, add=T)
dev.off()
png(filename = sprintf("%s/%s.png", target, str_pad(y_i, 4, pad="0")),
width = 1600, height = 900, units = "px")
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t, col=colfunc(100)[shape_t@data$n], cex=0.6, pch=15, add=T)
dev.off()
png(filename = sprintf("%s/%s.png", target, str_pad(y_i, 4, pad="0")),
width = 1600, height = 900, units = "px")
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t, col=colfunc(100)[shape_t@data$n], cex=0.7, pch=15, add=T)
dev.off()
png(filename = sprintf("%s/%s.png", target, str_pad(y_i, 4, pad="0")),
width = 1600, height = 900, units = "px")
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t, col=colfunc(100)[shape_t@data$n], cex=0.6, pch=15, add=T)
dev.off()
png(filename = sprintf("%s/%s.png", target, str_pad(y_i, 4, pad="0")),
width = 1600, height = 900, units = "px")
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t, col=colfunc(100)[shape_t@data$n], cex=0.65, pch=15, add=T)
dev.off()
y_i
y<-names(df)[y_i]
print(y)
richness_df<-df[[y]]%>%count(ID)
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t, col=colfunc(100)[shape_t@data$n], cex=0.65, pch=15, add=T)
for (y_i in c(1:length(df))){
y<-names(df)[y_i]
print(y)
richness_df<-df[[y]]%>%count(ID)
png(filename = sprintf("%s/%s.png", target, str_pad(y_i, 4, pad="0")),
width = 1600, height = 900, units = "px")
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t, col=colfunc(100)[shape_t@data$n], cex=0.65, pch=15, add=T)
dev.off()
}
print(sprintf(cmd, target, target, nb, da))
target
print(sprintf(cmd, target, target, nb, da))
cmd
cmd<-"ffmpeg -framerate 10 -pattern_type glob -i '%s/*.png' -c:v libx264 -pix_fmt yuv420p %s/../%s_%s.mp4"
print(sprintf(cmd, target, target, nb, da))
y_i=length(df)
print(y)
richness_df<-df[[y]]%>%count(ID)
png(filename = sprintf("%s/%s.png", target, str_pad(y_i, 4, pad="0")),
width = 1600, height = 900, units = "px")
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t, col=colfunc(100)[shape_t@data$n], cex=0.65, pch=15, add=T)
dev.off()
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t, col=colfunc(100)[shape_t@data$n], cex=0.65, pch=15, add=T)
print(y)
richness_df<-df[[y]]%>%count(ID)
png(filename = sprintf("%s/%s.png", target, str_pad(y_i, 4, pad="0")),
width = 1600, height = 900, units = "px")
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
plot(shape_t)
dev.off()
dev.off()
plot(shape_t
)
plot(shape_t, cex=0.2, pch=1)
shape_t@data$n
df[[y]]
max_col<-max((df[["0"]]%>%count(ID))$n)
max_col
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t, col=colfunc(max_col)[shape_t@data$n], cex=0.65, pch=15, add=T)
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t, col=colfunc(max_col+1)[shape_t@data$n], cex=0.65, pch=15, add=T)
y_i
y_i=1199
y<-names(df)[y_i]
print(y)
richness_df<-df[[y]]%>%count(ID)
png(filename = sprintf("%s/%s.png", target, str_pad(y_i, 4, pad="0")),
width = 1600, height = 900, units = "px")
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t, col=colfunc(max_col+1)[shape_t@data$n], cex=0.65, pch=15, add=T)
dev.off()
max_col<-max((df[["1"]]%>%count(ID))$n)
max_col
max_col<-max((df[["2"]]%>%count(ID))$n)
max_col
max_col<-c()
max_col<-c()
for (y_i in c(1:length(df))){
y<-names(df)[y_i]
max_col<-c(max_col, max((df[[y]]%>%count(ID))$n))
}
max_col
max(max_col)
max_col<-max(max_col)
for (y_i in c(1:length(df))){
y<-names(df)[y_i]
print(y)
richness_df<-df[[y]]%>%count(ID)
png(filename = sprintf("%s/%s.png", target, str_pad(y_i, 4, pad="0")),
width = 1600, height = 900, units = "px")
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t, col=colfunc(max_col)[shape_t@data$n], cex=0.65, pch=15, add=T)
dev.off()
}
plot(shape_t)
cmd<-"ffmpeg -framerate 10 -pattern_type glob -i '%s/*.png' -c:v libx264 -pix_fmt yuv420p %s/../%s_%s.mp4"
print(sprintf(cmd, target, target, nb, da))
dir.create(sprintf("%s/../Tables/%s.%s", source, nb, da), showWarnings = F)
saveRDS(shape_t, sprintf("%s/../Tables/%s.%s/%s.rda", source, nb, da, y))
y
names(df)
saveRDS(shape_t, sprintf("%s/../Tables/%s.%s/%s.rda", source, nb, da, str_pad(y_i, 4, pad="0")))
shape_t@data$n[which(shape_t@data$n>100)]
shape_t@data$n
nrow(shape_t@data$n)
nrow(shape_t@data)
length(shape_t@data$n[which(shape_t@data$n>100)])
length(shape_t@data$n[which(shape_t@data$n>200)])
length(shape_t@data$n[which(shape_t@data$n>300)])
dir.create(sprintf("%s/../Tables/%s.%s", source, nb, da), showWarnings = F)
for (y_i in c(1:length(df))){
y<-names(df)[y_i]
print(y)
richness_df<-df[[y]]%>%count(ID)
png(filename = sprintf("%s/%s.png", target, str_pad(y_i, 4, pad="0")),
width = 1600, height = 900, units = "px")
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
saveRDS(shape_t, sprintf("%s/../Tables/%s.%s/%s.rda", source, nb, da, str_pad(y_i, 4, pad="0")))
shape_t@data$n[which(shape_t@data$n>200)]<-200
plot(shape_t, col=colfunc(200)[shape_t@data$n], cex=0.65, pch=15, add=T)
dev.off()
}
cmd<-"ffmpeg -framerate 10 -pattern_type glob -i '%s/*.png' -c:v libx264 -pix_fmt yuv420p %s/../%s_%s.mp4"
print(sprintf(cmd, target, target, nb, da))
y_i=1200
y<-names(df)[y_i]
print(y)
richness_df<-df[[y]]%>%count(ID)
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t, col=colfunc(max(shape_t@data$n))[shape_t@data$n], cex=0.65, pch=15, add=T)
png(filename = sprintf("%s/%s.png", target, str_pad(y_i, 4, pad="0")),
width = 1600, height = 900, units = "px")
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t, col=colfunc(max(shape_t@data$n))[shape_t@data$n], cex=0.65, pch=15, add=T)
#plot(shape_t, col=colfunc(max(shape_t@data$n))[shape_t@data$n], cex=0.65, pch=15, add=T)
dev.off()
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
shape_t<-shape
shape_t@coords<-subset(shape_t@coords, shape_t$global_id %in% richness_df$ID)
shape_t@data<-subset(shape_t@data, shape_t$global_id %in% richness_df$ID)
shape_t@data$global_id<-as.numeric(as.character(shape_t@data$global_id))
shape_t@data<-inner_join(shape_t@data, richness_df, by=c("global_id"="ID"))
plot(shape_t, col=shape_t@data$n, cex=0.65, pch=15, add=T)
png(filename = sprintf("%s/%s.png", target, str_pad(y_i, 4, pad="0")),
width = 1600, height = 900, units = "px")
plot(worldmap, border="grey", main=(as.numeric(y)*-1))
#plot(shape_t, col=shape_t@data$n, cex=0.65, pch=15, add=T)
plot(shape_t, col=shape_t@data$n, cex=0.65, pch=15, add=T)
dev.off()
